<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Documentation - LexGUI</title>
    <link rel="stylesheet" href="../build/lexgui.css">
    <link rel="stylesheet" href="../build/lexgui-docs.css">
    <link rel="icon" href="../images/favicon.png">
    <script type="importmap">
        {
          "imports": {
            "lexgui": "../build/lexgui.module.js",
            "lexgui/components/": "../build/components/"
          }
        }
    </script>
</head>
    <body>
        <div id="content"></div>
    <script type="module">

        import { LX } from 'lexgui';
        import 'lexgui/components/codeeditor.js';
        import 'lexgui/components/docmaker.js';

        window.LX = LX;

        const mobile = navigator && /Android|iPhone/i.test( navigator.userAgent );
        const content = document.getElementById('content');
        const oldScripts = [];

        SET_DOM_TARGET( content );

        window.loadPage = function(page, addToHistory = true, title, callback) {
            fetch(page)
                .then(response => response.text())
                .then(html => {

                    content.parentElement.scrollTop = 0;

                    oldScripts.forEach(script => script.remove());

                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = html;
                    
                    const scripts = tempDiv.querySelectorAll("script");
                    scripts.forEach(script => script.remove());

                    content.innerHTML = tempDiv.innerHTML;

                    scripts.forEach(script => {
                        const newScript = document.createElement("script");
                        newScript.type = script.type;
                        if (script.src) {
                            newScript.src = script.src; // external scripts
                            newScript.onload = () => console.log(`Loaded: ${script.src}`);
                        } else {
                            newScript.textContent = script.textContent; // inline scripts
                        }
                        document.body.prepend(newScript);
                        oldScripts.push( newScript );
                    });

                    if( addToHistory )
                    {
                        history.pushState({ page }, "", `?p=${page.replace( ".html", "" )}`);
                    }

                    if( title ) document.title = `${ title } - LexGUI`;
                })
                .then( callback )
                .catch(() => content.innerHTML = "<p>Error loading content.</p>");
        }

        window.__addInteractiveCodeExample = function( content, widgetName, onPanel ) {

            const area = new LX.Area({ className: "flex flex-col gap-3 docs", skipAppend: true, height: "auto" });
            content.appendChild( area.root );
            const panel = window.__panel = area.addPanel();
            panel.branch( widgetName );
            onPanel( panel );

            const runCode = () => {
                const script = document.createElement( 'script' );
                script.type = 'module';
                script.innerHTML = `
                    const panel = window.__panel;
                    panel.clear();
                    panel.branch("${ widgetName }");
                    ${ codeEditor.getText() }
                `;
                script.async = false;
                document.getElementsByTagName( 'head' )[ 0 ].appendChild( script );
            }

            const codeArea = new LX.Area({ className: "rounded overflow-hidden", skipAppend: true, height: "auto" });
            area.attach( codeArea.root );
            const codeEditor = new LX.CodeEditor( codeArea, { name: `${widgetName.toLowerCase().replace( /\s/g, '_' )}.js`, onrun: runCode, skipInfo: true, allowAddScripts: false, language: "JavaScript" } );

            let code = onPanel.toString();
            let lines = code.split( '\n' ).slice( 1, -1 );
            code = lines.map( line => line.substr( 12 ) ).join( '\n' );
            codeEditor.setText( code, "JavaScript" );

            const runButton = new LX.Button( null, "Run", (value, event) => {
                runCode();
            }, { buttonClass: "contrast" } );
            area.attach( runButton.root );
        }

        window.addEventListener("popstate", function (event) {
            if (event.state?.page) {
                loadPage(event.state.page, false);
            }
        });

        // get the last commit date
        window.getLastCommitDate = async function (owner, repo, branch) {
            const url = `https://api.github.com/repos/${owner}/${repo}/commits/${branch}`;

            const response = await fetch(url, {
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                }
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status}`);
            }

            const data = await response.json();
            const commitDate = data.commit.committer.date;

            function formatDate(isoDateStr) {
                const date = new Date(isoDateStr);
                const day = String(date.getUTCDate()).padStart(2, '0');
                const month = String(date.getUTCMonth() + 1).padStart(2, '0'); // Months are 0-indexed
                const year = date.getUTCFullYear();
                return `${day}/${month}/${year}`;
            }

            return formatDate(commitDate);
        }

        // Init library and get main area
        let area = await LX.init( { rootClass: "wrapper" } );
        let menubar = null;

        const localHost = window.location.protocol !== "https:";
        const starterTheme = LX.getTheme();
        const menubarButtons = [
            {
                title: "Change Theme",
                icon: starterTheme == "dark" ? "Moon" : "Sun",
                swap: starterTheme == "dark" ? "Sun" : "Moon",
                callback:  (value, event) => { LX.switchTheme() }
            },
            {
                title: "Switch Spacing",
                icon: "AlignVerticalSpaceAround",
                callback:  (value, event) => { LX.switchSpacing() }
            }
        ];
        const sidebarOptions = {
            headerTitle: localHost ? `lexgui.js` : `lexgui.js v${ LX.version }`,
            headerSubtitle: localHost ? `v${ LX.version }` : await window.getLastCommitDate( "jxarco", 'lexgui.js', 'master' )
                    .then(date => 'Last Updated on ' + date)
                    .catch(err => {
                        console.error(err);
                        '';
                    }),
            headerImage: "../images/favicon.png",
            footerTitle: "jxarco",
            footerSubtitle: "alexroco.30@gmail.com",
            footerImage: "https://avatars.githubusercontent.com/u/25059187?s=400&u=ad8907b748c13e4e1a7cdd3882826acb6a2928b5&v=4",
            onFooterPressed: (event, dom) => {
                event.preventDefault();
                LX.addDropdownMenu( dom, [
                    "Other Projects",
                    null,
                    { name: "wgpuEngine", icon: "Torus", callback: () => open( "https://github.com/upf-gti/wgpuEngine", "_blank" ) },
                    { name: "Rooms VR", icon: "DoorOpen", callback: () => open( "https://github.com/upf-gti/rooms", "_blank" ) },
                    null,
                    "Socials",
                    null,
                    { name: "Github", icon: "Github", callback: () => open( "https://github.com/jxarco", "_blank" ) },
                    { name: "Linkedin", icon: "Linkedin", callback: () => open( "https://www.linkedin.com/in/alejandro-roco/", "_blank" ) },
                ], { side: "right", align: "start" });
            },
            collapsed: false,
            collapsable: false,
            displaySelected: true
        };

        const open = ( url, target, name, dom, event ) => {
            if( event ) event.preventDefault();

            const anchor = target && ( target[ 0 ] == '#' );

            if( target && !anchor )
            {
                window.open( url, target );
            }
            else
            {
                loadPage( url, true, name, () => {
                    if( anchor )
                    {
                        LX.doAsync( () => document.getElementById( target.substring( 1 ) )?.scrollIntoView({ behavior: 'smooth' }), 20 );
                    }
                } );
            }

            if( window.__currentSheet )
            {
                window.__currentSheet.destroy();
            }
        }

        const buttonToggleWidgets = [ "Button", "Checkbox", "Combo Buttons", "Radio Group", "Toggle" ];
        const dataInputWidgets = [ "Color", "Curve", "Date Picker", "File", "Form", "Item Array", "Layers", "Map 2D", "Number", "OTP Input", "Pad", "Range", "Select", "Size", "Tags", "Text", "Text Area", "Vector" ];
        const layoutWidgets = [ "Data Tree", "List", "Tab Sections", "Table", "Title" ];
        const miscWidgets = [ "Custom", "Progress", "Other Widgets" ];
        const widgetVersion = {
            "Date Picker": "5.9",
            "Form": "1.40",
            "Map 2D": "6.3",
            "OTP Input": "5.6",
            "Pad": "1.39",
            "Radio Group": "4.0",
            "Range": "3.0",
            "Size": "1.38",
            "Table": "2.0"
        };
        const badgeClass = "contrast sm";

        const sidebarCallback = m => {
            m.group( "Manual" );
            m.add( "Installation", { callback: open.bind( this, "installation.html", null ) } );
            m.add( "Getting Started", { callback: open.bind( this, "getting-started.html", null ) } );
            m.add( "Creating Areas", { callback: open.bind( this, "creating-areas.html", null ) } );
            m.add( "Instancing Panels", { callback: open.bind( this, "instancing-panels.html", null ) } );
            m.add( "Panel Branching", { callback: open.bind( this, "branching.html", null ) } );
            m.add( "Adding First Widgets", { callback: open.bind( this, "first-widgets.html", null ) } );
            m.add( "Dialogs", { callback: open.bind( this, "dialogs.html", null ) } );
            m.add( "Notifications", { callback: open.bind( this, "notifications.html", null ) } );
            m.add( "Context Menus", { callback: open.bind( this, "context-menu.html", null ) } );
            m.add( "Event Handling", { callback: open.bind( this, "event-handling.html", null ) } );
            m.add( "Theme Customization", { callback: open.bind( this, "themes.html", null ) } );
            m.add( "Asset View", { callback: open.bind( this, "asset-view.html", null ) } );
            m.add( "User Tour", { callback: open.bind( this, "tour.html", null ), content: LX.badge( "6.11", badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", "#6.11" ) }) } );
            m.add( "Skeleton", { callback: open.bind( this, "skeleton.html", null ), content: LX.badge( "7.0", badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", "#7.0" ) }) } );
            m.add( "Icons", { callback: open.bind( this, "icons.html", null ) } );
            m.separator();
            m.group( "Widgets" );

            m.add( "Buttons and Toggles", { skipSelection: true } );
            for( const w of buttonToggleWidgets )
            {
                const url = w.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Buttons and Toggles/" + w, {
                    callback: open.bind( this, "widgets/" + url, null ),
                    content: widgetVersion[ w ] ? LX.badge( widgetVersion[ w ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ widgetVersion[ w ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( w, open.bind( this, "widgets/" + url, null ) );
            }

            m.add( "Data Inputs", { skipSelection: true } );
            for( const w of dataInputWidgets )
            {
                const url = w.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Data Inputs/" + w, {
                    callback: open.bind( this, "widgets/" + url, null ),
                    content: widgetVersion[ w ] ? LX.badge( widgetVersion[ w ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ widgetVersion[ w ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( w, open.bind( this, "widgets/" + url, null ) );
            }

            m.add( "Layout and Structure", { skipSelection: true } );
            for( const w of layoutWidgets )
            {
                const url = w.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Layout and Structure/" + w, {
                    callback: open.bind( this, "widgets/" + url, null ),
                    content: widgetVersion[ w ] ? LX.badge( widgetVersion[ w ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ widgetVersion[ w ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( w, open.bind( this, "widgets/" + url, null ) );
            }

            m.add( "Misc", { skipSelection: true } );
            for( const w of miscWidgets )
            {
                const url = w.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Misc/" + w, {
                    callback: open.bind( this, "widgets/" + url, null ),
                    content: widgetVersion[ w ] ? LX.badge( widgetVersion[ w ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ widgetVersion[ w ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( w, open.bind( this, "widgets/" + url, null ) );
            }

            m.separator();
            m.group( "Components" );
            m.add( "Code Editor", { callback: open.bind( this, "components/code-editor.html", null ) } );
            m.add( "Doc Maker", { callback: open.bind( this, "components/doc-maker.html", null ) } );
            m.add( "Graph Editor", { callback: open.bind( this, "components/graph-editor.html", null ) } );
            m.add( "Timeline", { callback: open.bind( this, "components/timeline.html", null ) } );
            m.add( "Timeline/Keyframes Timeline", { callback: open.bind( this, "components/keyframe-timeline.html", null ) } );
            m.add( "Timeline/Clips Timeline", { callback: open.bind( this, "components/clips-timeline.html", null ) } );
            m.add( "Video Editor", { callback: open.bind( this, "components/video-editor.html", null ) } );
            m.separator();
            m.add( "API Reference", { skipSelection: true } );
            m.add( "API Reference/Area", { callback: open.bind( this, "reference/area.html", null ) } );
            m.add( "API Reference/AreaOverlayButtons", { callback: open.bind( this, "reference/area-overlay-buttons.html", null ), content: LX.badge( "6.10", badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", "#6.10" ) }) } );
            m.add( "API Reference/Branch", { callback: open.bind( this, "reference/branch.html", null ) } );
            m.add( "API Reference/Menubar", { callback: open.bind( this, "reference/menubar.html", null ) } );
            m.add( "API Reference/Panel", { callback: open.bind( this, "reference/panel.html", null ) } );
            m.add( "API Reference/Sidebar", { callback: open.bind( this, "reference/sidebar.html", null ) } );
            m.add( "API Reference/Tabs", { callback: open.bind( this, "reference/tabs.html", null ) } );
            m.add( "API Reference/Widget", { callback: open.bind( this, "reference/widget.html", null ) } );
            m.separator();
            m.add( "LexGUI Examples", { icon: "Monitor", skipSelection: true, callback: open.bind( this, "../examples/", "_blank" ) } );
            m.add( "Source Code", { icon: "Code", skipSelection: true, callback: open.bind( this, "https://github.com/jxarco/lexgui.js/", "_blank" ) } );
            m.add( "Changelog", { icon: "Logs", skipSelection: true, callback: open.bind( this, "changelog.html", null ) } );
        }

        if( mobile )
        {
            menubar = area.addMenubar();

            const sheetArea = new LX.Area({ skipAppend: true });
            sheetArea.addSidebar( sidebarCallback, sidebarOptions );

            menubarButtons.splice( 0, 0,
                {
                    title: "Menu",
                    icon: "PanelLeft",
                    callback: (value, event) => {
                        window.__currentSheet = new LX.Sheet("256px", [ sheetArea ] );
                    }
                }
            );
        }
        else
        {
            const sidebar = area.addSidebar( sidebarCallback, sidebarOptions );
            menubar = sidebar.siblingArea.addMenubar();
        }

        menubar.addButtons( menubarButtons );

        menubar.setButtonImage("lexgui.js", `../images/icon_${ starterTheme }.png`, () => {window.open("https://jxarco.github.io/lexgui.js/")}, {float: "left"})
        LX.addSignal( "@on_new_color_scheme", ( el, value ) => {
            menubar.setButtonImage("lexgui.js", `../images/icon_${ value }.png` );
        } );

        menubar.siblingArea.root.style.overflowY = "scroll";
        menubar.siblingArea.root.appendChild( content );

        let params = new URLSearchParams( document.location.search );
        loadPage( ( params.get( "p" ) ?? "installation" ) + ".html", false );

    </script>
    </body>
</html>