<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Documentation - LexGUI</title>
    <link rel="stylesheet" href="../build/lexgui.css">
    <link rel="icon" href="../images/favicon.png">
    <script type="importmap">
        {
          "imports": {
            "lexgui": "../build/lexgui.module.js",
            "lexgui/extensions/": "../build/extensions/"
          }
        }
    </script>
</head>
    <body>
        <div id="content"></div>
    <script type="module">

        import { LX } from 'lexgui';
        import { CodeEditor } from 'lexgui/extensions/CodeEditor.js';
        import { DocMaker } from 'lexgui/extensions/Docmaker.js';
        import { AssetView } from 'lexgui/extensions/AssetView.js';

        window.LX = LX;

        globalThis.docMaker = new DocMaker();
        const mobile = navigator && /Android|iPhone/i.test( navigator.userAgent );
        const content = document.getElementById('content');
        const oldScripts = [];
        let path = null;

        docMaker.setDomTarget( content );

        window.setPath = function( startPage ) {

            const tokens = startPage.split( '/' );
            const startPath = [];

            for( let t of tokens )
            {
                const pToken = LX.toTitleCase( t );

                if( startPath.length && startPath[ 0 ] == "Components" )
                {
                    if( generalComponents.includes( pToken ) ) startPath.push( "General" );
                    if( dataInputComponents.includes( pToken ) ) startPath.push( "Data Input" );
                    if( dataDisplayComponents.includes( pToken ) ) startPath.push( "Data Display" );
                    if( feedbackComponents.includes( pToken ) ) startPath.push( "Feedback" );
                    if( navigationComponents.includes( pToken ) ) startPath.push( "Navigation" );
                }

                startPath.push( pToken == "Api" ? "API Reference" : pToken );
            }

            if( startPath.length )
            {
                path = startPath;
            }

            return startPath.pop();
        }

        window.loadPage = function(page, addToHistory = true, title, callback) {
            fetch(page)
                .then(response => response.text())
                .then(html => {

                    content.parentElement.scrollTop = 0;

                    oldScripts.forEach(script => script.remove());

                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = html;
                    
                    const scripts = tempDiv.querySelectorAll("script");
                    scripts.forEach(script => script.remove());
                    content.innerHTML = "";

                    // Generate breadcrumb
                    if( path !== null )
                    {
                        const bcItems = [];

                        for( let p of path )
                        {
                            bcItems.push( { title: p } );
                        }

                        if( title )
                        {
                            bcItems.push( { title } );
                        }

                        content.appendChild( LX.makeBreadcrumb( bcItems ) );
                    }

                    content.innerHTML += tempDiv.innerHTML;

                    scripts.forEach(script => {
                        const newScript = document.createElement("script");
                        newScript.type = script.type;
                        if (script.src) {
                            newScript.src = script.src; // external scripts
                            newScript.onload = () => console.log(`Loaded: ${script.src}`);
                        } else {
                            newScript.textContent = script.textContent; // inline scripts
                        }
                        document.body.prepend(newScript);
                        oldScripts.push( newScript );
                    });

                    if( addToHistory )
                    {
                        history.pushState({ page }, "", `?p=${page.replace( ".html", "" )}`);
                    }

                    if( title ) document.title = `${ title } - LexGUI`;
                })
                .then( callback )
                .catch((err) => {
                    console.error( err );
                    content.innerHTML = "<p>Error loading content.</p>";
                });
        }

        window.__addInteractiveCodeExample = function( content, componentName, onPanel ) {

            const area = new LX.Area({ className: "flex flex-col gap-3 docs", skipAppend: true, height: "auto" });
            content.appendChild( area.root );
            const panel = window.__panel = area.addPanel();
            panel.branch( componentName );
            onPanel( panel );

            const runCode = () => {
                const script = document.createElement( 'script' );
                script.type = 'module';
                script.innerHTML = `
                    const panel = window.__panel;
                    panel.clear();
                    panel.branch("${ componentName }");
                    ${ codeEditor.getText() }
                `;
                script.async = false;
                document.getElementsByTagName( 'head' )[ 0 ].appendChild( script );
            }

            const codeArea = new LX.Area({ className: "rounded overflow-hidden", skipAppend: true, height: "auto" });
            area.attach( codeArea.root );
            const codeEditor = new CodeEditor( codeArea, { name: `${componentName.toLowerCase().replace( /\s/g, '_' )}.js`, onrun: runCode, skipInfo: true, allowAddScripts: false, language: "JavaScript" } );

            let code = onPanel.toString();
            let lines = code.split( '\n' ).slice( 1, -1 );
            code = lines.map( line => line.substr( 12 ) ).join( '\n' );
            codeEditor.setText( code, "JavaScript" );

            const runButton = new LX.Button( null, "Run", (value, event) => {
                runCode();
            }, { buttonClass: "contrast" } );
            area.attach( runButton.root );
        }

        window.addEventListener("popstate", function (event) {
            if (event.state?.page) {
                loadPage(event.state.page, false);
            }
        });

        // get the last commit date
        window.getLastCommitDate = async function (owner, repo, branch) {
            const url = `https://api.github.com/repos/${owner}/${repo}/commits/${branch}`;

            const response = await fetch(url, {
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                }
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status}`);
            }

            const data = await response.json();
            const commitDate = data.commit.committer.date;

            function formatDate(isoDateStr) {
                const date = new Date(isoDateStr);
                const day = String(date.getUTCDate()).padStart(2, '0');
                const month = String(date.getUTCMonth() + 1).padStart(2, '0'); // Months are 0-indexed
                const year = date.getUTCFullYear();
                return `${day}/${month}/${year}`;
            }

            return formatDate(commitDate);
        }

        // Init library and get main area
        let area = await LX.init( { rootClass: "wrapper" } );
        let menubar = null;

        const localHost = window.location.protocol !== "https:";
        const starterTheme = LX.getTheme();
        const menubarButtons = [
            {
                title: "Change Theme",
                icon: starterTheme == "dark" ? "Moon" : "Sun",
                swap: starterTheme == "dark" ? "Sun" : "Moon",
                callback:  (value, event) => { LX.switchTheme() }
            },
            {
                title: "Switch Spacing",
                icon: "AlignVerticalSpaceAround",
                callback:  (value, event) => { LX.switchSpacing() }
            }
        ];
        const sidebarOptions = {
            headerTitle: localHost ? `lexgui.js` : `lexgui.js v${ LX.version }`,
            headerSubtitle: localHost ? `v${ LX.version }` : await window.getLastCommitDate( "jxarco", 'lexgui.js', 'master' )
                    .then(date => 'Last Updated on ' + date)
                    .catch(err => {
                        console.error(err);
                        '';
                    }),
            headerImage: "../images/favicon.png",
            footerTitle: "jxarco",
            footerSubtitle: "alexroco.30@gmail.com",
            footerImage: "https://avatars.githubusercontent.com/u/25059187?s=400&u=ad8907b748c13e4e1a7cdd3882826acb6a2928b5&v=4",
            onFooterPressed: (event, dom) => {
                event.preventDefault();
                LX.addDropdownMenu( dom, [
                    "Other Projects",
                    null,
                    { name: "wgpuEngine", icon: "Torus", callback: () => open( "https://github.com/upf-gti/wgpuEngine", "_blank" ) },
                    { name: "Rooms VR", icon: "DoorOpen", callback: () => open( "https://github.com/upf-gti/rooms", "_blank" ) },
                    null,
                    "Socials",
                    null,
                    { name: "Github", icon: "Github", callback: () => open( "https://github.com/jxarco", "_blank" ) },
                    { name: "Linkedin", icon: "Linkedin", callback: () => open( "https://www.linkedin.com/in/alejandro-roco/", "_blank" ) },
                ], { side: "right", align: "start" });
            },
            collapsed: false,
            collapsable: false,
            displaySelected: true
        };

        const open = ( url, target, name, dom, event ) => {
            if( event ) event.preventDefault();

            const anchor = target && ( target[ 0 ] == '#' );
            const breadcrumb = target && ( target.constructor === Array );

            if( target && !anchor && !breadcrumb )
            {
                window.open( url, target );
            }
            else
            {
                path = null;

                if( breadcrumb )
                {
                    path = target;
                }

                loadPage( url, true, name, () => {
                    if( anchor )
                    {
                        LX.doAsync( () => document.getElementById( target.substring( 1 ) )?.scrollIntoView({ behavior: 'smooth' }), 20 );
                    }
                } );
            }

            if( window.__currentSheet )
            {
                window.__currentSheet.destroy();
            }
        }

        const generalComponents = [ "Area Overlay Buttons", "Badge", "Button", "Combo Buttons", "Radio Group" ];
        const dataInputComponents = [ "Array", "Checkbox", "Color", "Curve", "Custom", "Date Picker", "File", "Form", "Layers", "Map 2D", "Number", "OTP Input", "Pad", "Range", "Rate", "Select", "Size", "Tags", "Text", "Text Area", "Toggle", "Vector" ];
        const dataDisplayComponents = [ "Code Snippet", "Data Tree", "List", "Table", "Title" ];
        const feedbackComponents = [ "Progress", "Skeleton", "Toast" ];
        const navigationComponents = [ "Breadcrumb", "Dropdown", "Menubar", "Sidebar", "Tab Sections", "Tabs" ];
        const overlayComponents = [ "Dialog", "Popover", "Sheet", "Tour" ];

        const componentVersion = {
            "Area Overlay Buttons": "6.10",
            "Breadcrumb": "7.0",
            "Date Picker": "5.9",
            "Popover": "5.9",
            "Map 2D": "6.3",
            "OTP Input": "5.6",
            "Radio Group": "4.0",
            "Range": "3.0",
            "Rate": "7.0",
            "Sidebar": "4.0",
            "Sheet": "6.0",
            "Skeleton": "7.0",
            "Tour": "6.11"
        };
        const badgeClass = "contrast sm";

        const sidebarCallback = m => {

            const manualCallback = v => open( `manual/${ v.toLowerCase().replaceAll( " ", "-" ) }.html`, [ "Manual" ], v );
            const extensionCallback = v => open( `extensions/${ v.toLowerCase().replaceAll( " ", "-" ) }.html`, [ "Extensions" ], v );
            const apiReferenceCallback = v => open( `api/${ v.toLowerCase().replaceAll( " ", "-" ) }.html`, [ "API Reference" ], v );

            m.group( "Manual" );
            m.add( "Installation", { callback: manualCallback } );
            m.add( "Getting Started", { callback: manualCallback } );
            m.add( "Creating Areas", { callback: manualCallback } );
            m.add( "Instancing Panels", { callback: manualCallback } );
            m.add( "Panel Branching", { callback: manualCallback } );
            m.add( "First Components", { callback: manualCallback } );
            m.add( "Event Handling", { callback: manualCallback } );
            m.add( "Theme Customization", { callback: manualCallback } );
            m.add( "Icons", { callback: manualCallback } );
            m.separator();
            m.group( "Components" );
            m.add( "General", { skipSelection: true } );
            for( const c of generalComponents )
            {
                const url = c.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "General/" + c, {
                    callback: open.bind( this, "components/" + url, ["Components", "General"] ),
                    content: componentVersion[ c ] ? LX.badge( componentVersion[ c ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ componentVersion[ c ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( c, open.bind( this, "components/" + url, null ) );
            }
            m.add( "Data Display", { skipSelection: true } );
            for( const c of dataDisplayComponents )
            {
                const url = c.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Data Display/" + c, {
                    callback: open.bind( this, "components/" + url, ["Components", "Data Display"] ),
                    content: componentVersion[ c ] ? LX.badge( componentVersion[ c ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ componentVersion[ c ] }` ) }) : undefined
                } );
                
                LX.registerCommandbarEntry( c, open.bind( this, "components/" + url, null ) );
            }
            m.add( "Data Inputs", { skipSelection: true } );
            for( const c of dataInputComponents )
            {
                const url = c.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Data Inputs/" + c, {
                    callback: open.bind( this, "components/" + url, ["Components", "Data Inputs"] ),
                    content: componentVersion[ c ] ? LX.badge( componentVersion[ c ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ componentVersion[ c ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( c, open.bind( this, "components/" + url, null ) );
            }
            m.add( "Feedback", { skipSelection: true } );
            for( const c of feedbackComponents )
            {
                const url = c.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Feedback/" + c, {
                    callback: open.bind( this, "components/" + url, ["Components", "Feedback"] ),
                    content: componentVersion[ c ] ? LX.badge( componentVersion[ c ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ componentVersion[ c ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( c, open.bind( this, "components/" + url, null ) );
            }
            m.add( "Navigation", { skipSelection: true } );
            for( const c of navigationComponents )
            {
                const url = c.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Navigation/" + c, {
                    callback: open.bind( this, "components/" + url, ["Components", "Navigation"] ),
                    content: componentVersion[ c ] ? LX.badge( componentVersion[ c ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ componentVersion[ c ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( c, open.bind( this, "components/" + url, null ) );
            }
            m.add( "Overlay", { skipSelection: true } );
            for( const c of overlayComponents )
            {
                const url = c.toLowerCase().replace( /\s/g, '-') + ".html";
                m.add( "Overlay/" + c, {
                    callback: open.bind( this, "components/" + url, ["Components", "Overlay"] ),
                    content: componentVersion[ c ] ? LX.badge( componentVersion[ c ], badgeClass, { asElement: true, callback: open.bind( this, "changelog.html", `#${ componentVersion[ c ] }` ) }) : undefined
                } );

                LX.registerCommandbarEntry( c, open.bind( this, "components/" + url, null ) );
            }
            m.separator();
            m.group( "Extensions" );
            m.add( "Asset View", { callback: extensionCallback } );
            m.add( "Code Editor", { callback: extensionCallback } );
            m.add( "Doc Maker", { callback: extensionCallback } );
            m.add( "Graph Editor", { callback: extensionCallback } );
            m.add( "Timeline", { callback: extensionCallback } );
            m.add( "Timeline/Keyframes Timeline", { callback: extensionCallback } );
            m.add( "Timeline/Clips Timeline", { callback: extensionCallback } );
            m.add( "Video Editor", { callback: extensionCallback } );
            m.separator();
            m.add( "API Reference", { skipSelection: true } );
            m.add( "API Reference/Area", { callback: apiReferenceCallback } );
            m.add( "API Reference/BaseComponent", { callback: apiReferenceCallback } );
            m.add( "API Reference/Branch", { callback: apiReferenceCallback } );
            m.add( "API Reference/Panel", { callback: apiReferenceCallback } );
            m.separator();
            m.add( "LexGUI Examples", { icon: "Monitor", skipSelection: true, callback: open.bind( this, "../examples/", "_blank" ) } );
            m.add( "Source Code", { icon: "Code", skipSelection: true, callback: open.bind( this, "https://github.com/jxarco/lexgui.js/", "_blank" ) } );
            m.add( "Changelog", { icon: "Logs", skipSelection: true, callback: open.bind( this, "changelog.html", null ) } );
        }

        if( mobile )
        {
            menubar = area.addMenubar();

            const sheetArea = new LX.Area({ skipAppend: true });
            sheetArea.addSidebar( sidebarCallback, sidebarOptions );

            menubarButtons.splice( 0, 0,
                {
                    title: "Menu",
                    icon: "PanelLeft",
                    callback: (value, event) => {
                        window.__currentSheet = new LX.Sheet("256px", [ sheetArea ] );
                    }
                }
            );
        }
        else
        {
            const sidebar = area.addSidebar( sidebarCallback, sidebarOptions );
            menubar = sidebar.siblingArea.addMenubar();
        }

        menubar.addButtons( menubarButtons );

        menubar.setButtonImage("lexgui.js", `../images/icon_${ starterTheme }.png`, () => {window.open("https://jxarco.github.io/lexgui.js/")}, {float: "left"})
        LX.addSignal( "@on_new_color_scheme", ( el, value ) => {
            menubar.setButtonImage("lexgui.js", `../images/icon_${ value }.png` );
        } );

        menubar.siblingArea.root.style.overflowY = "scroll";
        menubar.siblingArea.root.appendChild( content );

        const params = new URLSearchParams( document.location.search );
        const queryPage = params.get( "p" );
        const startPage = queryPage ?? "manual/installation";
        const tabName = window.setPath( startPage );

        loadPage( `${ startPage }.html`, !!queryPage, tabName );

    </script>
    </body>
</html>