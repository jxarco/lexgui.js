<script type="module">
    import { LX } from 'lexgui';

    const content = document.getElementById('content');
    const componentName = "Custom";

    docMaker.header(componentName + ".", "h1", componentName.toLowerCase());
    docMaker.paragraph(`Lexgui supports generating custom components based on specific object data. By calling the function ${docMaker.iCode("LX.ADD_CUSTOM_COMPONENT( name, options )")}, 
        you can register a new Panel method that will create your custom components. Once the component has been registered, call ${docMaker.iCode("Panel.add&lt;ComponentName&gt;(name, value, callback)")} to add the Custom Component to your panel.`);
    docMaker.header("Usage", "h2");
    docMaker.paragraph(`Within the options of ${docMaker.iCode("LX.ADD_CUSTOM_COMPONENT")}, you can add the following data:`);

    docMaker.codeBulletList( [
        [ "icon", "String", "Icon to be added into the custom component" ],
        [ "default", "Object", "The data for a default instance of your class" ],
        [ "onCreate", "Function", "Callback to add more components to the instance panel" ],
    ] )

    docMaker.note( `If you are using non-native types (e.g. Emscripten handles, or any other custom classes which LexGUI doesn't know how to inspect), you can add getters and setters for each of your
    default properties (see example code below).`, true )

    docMaker.code( `@[com]// Getters convert to native Array type@
@[com]// and Setters convert to custom class from native Array type@

@[cls]LX@.@[mtd]REGISTER_COMPONENT@( @"AABB"@, {
    icon: @"Box"@,
    @[mtd]_get_center@: @function@() {
        @return@ [ @this@.center.x, @this@.center.y, @this@.center.z ];
    },
    @[mtd]_set_center@: @function@( value ) {
        @this@.center.x = value[ @0@ ]; @this@.center.y = value[ @1@ ]; @this@.center.z = value[ @2@ ];
    },
    @[mtd]_get_halfSize@: @function@() {
        @return@ [ @this@.halfSize.x, @this@.halfSize.y, @this@.halfSize.z ];
    },
    @[mtd]_set_halfSize@: @function@( value ) {
        @this@.halfSize.x = value[ @0@ ]; @this@.halfSize.y = value[ @1@ ]; @this@.halfSize.z = value[ @2@ ];
    },
    default: {
        center: @new@ @[cls]Vector3@( @0.0@ ),
        halfSize: @new@ @[cls]Vector3@( @0.0@ )
    }
});` );

    docMaker.lineBreak();
    docMaker.paragraph(`You can also provide a custom creation callback (${docMaker.iCode("options.onCreate")}) that runs when the component is created, allowing you to add additional components beyond the default instance property components, such as buttons.
    Since the registration only occur once, you can pass your custom parameters when you create each of the instance components, which will be available when the creation function is called: `);

        docMaker.code( `@[cls]LX@.@[mtd]REGISTER_COMPONENT@( @"Shader"@, {
    icon: @"FileText"@,
    default: {
        path: @""@,
        type: @[cls]Shader@.@[enu]Standard@
    },

    @[com]// _instance_ and _node_ are custom user data@
    onCreate: ( panel, instance, node ) => {
        @if@( @this@.shaderData[ instance.path ] ) {
            panel.@[mtd]addButton@( @null@, @"Edit Shader"@, ( value ) => {
                @this@.@[mtd]editShader@( shader );
            }, { buttonClass: @"accent"@ } );
        }
        @else@ {
            panel.@[mtd]addButton@( @null@, @"New Shader"@, ( value ) => {
                @this@.@[mtd]createNewShader@( node );
            }, { buttonClass: @"contrast"@ } );
        }
    }
});` );

    {
        window.__addInteractiveCodeExample( content, componentName, panel => {
            LX.REGISTER_COMPONENT('Shader', {
                icon: "Box",
                default: {
                    'position': [0, 0],
                    'velocity': [0, 0, 0],
                    'color': [0, 0, 0, 0],
                    'hexColor': '#000',
                    'highRes': false
                },
                onCreate: ( panel, buttonName, printName ) => {
                    panel.addButton( null, buttonName, ( value ) => {
                        console.log( printName )
                    }, { buttonClass: "accent" } );
                }
            });

            const shaderInstance = {
                'hexColor': '#f5f505',
                'highRes': true
            };

            panel.addShader("PBR Shader", shaderInstance, (instance) => { console.log(instance) }, "MyButton", "Print this" );
            panel.addShader("Empty", null, null, "MySecondButton", "Print also this" );
        });
    }

    docMaker.header("API Reference", "h2");

    {
        const area = new LX.Area( { skipAppend: true, height: "auto", className: "mb-6" } );
        const panel = area.addPanel();
        content.appendChild( area.root );

        panel.addTable( null, {
            head: [ "Parameter", "Type", "Description", "Default" ],
            body: [
                ["name", "String", "Component name", "—"],
                ["value", "Object", "The new instance data", "—"],
                ["callback", "Function", "Function called when the instance changes", "—"]
            ].map( v => {
                return [ docMaker.iCode( v[ 0 ], "table" ), docMaker.iCode( v[ 1 ], "table desc" ), v[ 2 ], v[ 3 ] != "—" ? docMaker.iCode( v[ 3 ], "table desc" ) : v[ 3 ] ];
            } )
        }, {});
    }
</script>