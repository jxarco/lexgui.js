<script type="module">

    const content = document.querySelector( '.lexdocs-content' );
    const componentName = "Video Editor";
    docMaker.header(componentName + ".", "h1", componentName.toLowerCase());
    docMaker.paragraph( `Adds a rich video trimming/cropping UI with a time bar. It integrates with LX panels/areas and exposes controls for playback,
        start/end trimming, current time, and crop region, all with theming and responsive interaction.`, false, "text-muted-foreground" );

    {
        window.__addInteractiveCodeExample( content, componentName, panel => {
            const area = new LX.Area( { skipAppend: true, height: "700px" } );
            panel.attach( area.root );

            // detach all events and resources from the previous VE
            if( window.videoEditor ) {
                window.videoEditor.unbind(); 
            }
            const editor = window.videoEditor = new LX.VideoEditor(area, {
                src: "../data/video.mp4",
                crop: true,
                controls: true
            });

            editor.onSetTime = ( t ) => {
                console.log("Current time:", t);
            };

            editor.onCropArea = ( rect ) => {
                console.log("Cropped area:", rect);
            };
            
        } );
    }

    // Quick usage
    docMaker.header("Usage", "h2");
    docMaker.paragraph("Instantiate the editor by providing an LX area and options. You can supply a video source or element, enable crop, and react to time changes:");

    docMaker.header("API Reference", "h2");

    docMaker.header("TimeBar", "h3");
    docMaker.paragraph("Low-level timeline bar used internally for trimming and current time display. It handles drawing trim handles, current time marker, and reacts to theme changes.");
    docMaker.codeBulletList([
        ["constructor(area, type, options = {})", "Create a time bar. `type` is one of `TimeBar.TIMEBAR_PLAY` or `TIMEBAR_TRIM`. Options include `markerWidth`, `markerHeight`, `offset`, and `barHeight`."],
        ["updateTheme()", "Refreshes colors based on current theme."],
        ["update(x)", "Sets current position to `x` and redraws."],
        ["onMouseDown / onMouseUp / onMouseMove", "Internal interaction handlers for dragging trim/current markers."],
        ["resize(size)", "Recomputes internal positions when the container size changes."],
    ]);

    docMaker.header("VideoEditor", "h3");
    docMaker.classCtor( "class LX.VideoEditor", [
        ["area", "LX.Area"],
        ["options", "Object"]
    ] );
    docMaker.lineBreak();
    docMaker.paragraph(`High-level editor that embeds video playback with trimming and optional cropping overlay. Provides playback controls, time synchronization, and crop management.
    It has to be appended to an existing area. It means that it can be created anywhere in the document window (e.g. dialogs, panels, areas, etc.), since to create an area it's as easy as instancing a new one.` );
    docMaker.lineBreak();
    {
        const area = new LX.Area( { skipAppend: true, height: "auto", className: "mb-6" } );
        const panel = area.addPanel();
        content.appendChild( area.root );
        panel.addTable( null, {
            head: [ "Option", "Type", "Description", "Default" ],
            body: [
                ["src", "String", "Video URL", "-"],
                ["video", "HTMLVideoElement", "Video native element", "-"],
                ["crop", "Boolean", "Enable crop functionality", "-"],
                ["handleStyle", "Object", "Style properties for the resize handles", "-"],
                ["controls", "Boolean", "Enable playing controls for the video", "-"],
                ["controlsLayout", "Object", `See ${docMaker.iCode( "createControls" )}`, "-"],
            ].map( v => {
                return [ docMaker.iCode( v[ 0 ], "table" ), docMaker.iCode( v[ 1 ], "table desc" ), v[ 2 ], v[ 3 ] != "—" ? docMaker.iCode( v[ 3 ], "table desc" ) : v[ 3 ] ];
            } )
        }, {});
    }

    docMaker.header("Statics", "h4");

    docMaker.codeBulletList([
        ["CROP_HANDLE_L", `Enables the left resize handle in ${docMaker.iCode(`setCropAreaHandles`)},.`],
        ["CROP_HANDLE_R", `Enables the right resize handle in ${docMaker.iCode(`setCropAreaHandles`)},.`],
        ["CROP_HANDLE_T", `Enables the top resize handle in ${docMaker.iCode(`setCropAreaHandles`)},.`],
        ["CROP_HANDLE_B", `Enables the bottom resize handle in ${docMaker.iCode(`setCropAreaHandles`)},.`],
    ]);

    docMaker.header("Properties", "h4");

    docMaker.codeBulletList([
        ["controlsComponents", `${docMaker.iCode("Read Only")}. Object that stores the ui buttons and timebar to easily fetch them. See ${docMaker.iCode("createControls")}`],
    ]);

    docMaker.header("Methods", "h4");

    docMaker.classMethod( "showCropArea", "Displays the crop overlay and masks the underlying video.", [] );
    docMaker.classMethod( "hideCropArea", "Hides the crop overlay and clears masking." , [] );
    docMaker.classMethod( "showControls", "Display the playback/trimming controls.", [] );
    docMaker.classMethod( "hideControls", "Hides the playback/trimming controls.", [] );
    
    docMaker.classMethod( "createControls", `Generates all buttons and timebar, and displays them following a layout. ${docMaker.iCode("layoutOptions")} may have:`, [["layoutOptions", "object"]] );
    {
        const area = new LX.Area( { skipAppend: true, height: "auto", className: "mb-6" } );
        const panel = area.addPanel();
        content.appendChild( area.root );
        panel.addTable( null, {
            head: [ "Option", "Type", "Description", "Default" ],
            body: [
                ["type", `Number or Function`, `A number (0 or 1) will create a predefined layout. When a function, it must create the areas where the buttons and timebar (see ${docMaker.iCode("controlsComponents")}) will be and attach them. The function must also implement the ${docMaker.iCode("resizeControls")} function.`, `0`],
                ["height", `CSS Height value`, `Height of the controls area. The remaining will be set to the video area`, `15%`],
                ["l1TimelineHeight", `CSS Height value`, `(Predefined layout 1) Height of the trimming area. The remaining will be set to the rest of the controls area`, `50%`],
            ].map( v => {
                return [ docMaker.iCode( v[ 0 ], "table" ), docMaker.iCode( v[ 1 ], "table desc" ), v[ 2 ], v[ 3 ] != "—" ? docMaker.iCode( v[ 3 ], "table desc" ) : v[ 3 ] ];
            } )
        }, {});
    }
    docMaker.classMethod( "resize", "Triggered when parent area resizes. Call this functions to force a resize.", [] );
    docMaker.classMethod( "resizeVideo", "Triggered in resize. Call this functions to force a resize.", [] );
    docMaker.classMethod( "resizeControls", `Triggered in resize. Call this functions to force a resize. See ${docMaker.iCode("createControls")}.`, [] );
    docMaker.classMethod( "resizeCropArea", "Adjusts crop size based on pixel or normalized sizes. Sizes are restricted by the video size and current crop area position.", [["sx", "number"],["sy", "number"],["isNormalized", "boolean = true"]] );
    docMaker.classMethod( "moveCropArea","Adjusts crop location based on pixel or normalized coordinates. The position is restricted by the video size and current crop area size.", [["x", "number"],["y", "number"],["isNormalized", "boolean = true"]] );
    docMaker.classMethod( "setCropAreaHandles",  `Sets which resize handles to display based on flags. Use the ${docMaker.iCode(`|`)} operator to enable multiple handles (e.g. ${docMaker.iCode(`CROP_HANDLE_L | CROP_HANDLE_B`)})`, [["flags", "Number"]] );
    docMaker.classMethod( "getStartTime", "Returns current trim start time.", [] );
    docMaker.classMethod( "getEndTime", "Returns current trim end time.", [] );
    docMaker.classMethod( "getTrimedTimes", "Returns both start and end as `{ start, end }`.", [] );
    docMaker.classMethod( "getCroppedArea", "Returns the DOM rect of the crop overlay.", [] );
    docMaker.classMethod( "stopUpdates", "Stops the internal animation frame loop.", [] );
    docMaker.classMethod( "unbind", "Tears down listeners, pauses video, and clears playback state.", [] );

 
    docMaker.header("Callbacks / Hooks", "h3");
    docMaker.paragraph("You can assign handlers to respond to user interaction and internal state changes:");
    docMaker.codeBulletList([
        ["onChangeCurrent", "Triggered when current time marker changes (x position)."],
        ["onChangeStart", "Triggered when trim start marker moves."],
        ["onChangeEnd", "Triggered when trim end marker moves."],
        ["onSetTime", "Called when the actual video time is set (after conversion)."],
        ["onChangeSpeed", "Triggered when changing speed from the gui."],
        ["onChangeLoop", "Triggered when changing the video looping from the gui."],
        ["onChangeState", "Triggered when changing the video state (play/pause) from the gui."],
        ["onVideoLoaded", "Fired once the video is fully loaded and initialized."],
        ["onCropArea", "Called when cropping region changes after dragging/resizing."],
        ["onResize", "Called when parent area resizes."],
    ]);

    docMaker.note("If you dynamically resize the parent area, the editor listens to resize events and adjusts the time bar and crop overlay accordingly. Call `unbind()` before discarding the instance to avoid lingering listeners.", false, "Tip", "Info");
</script>