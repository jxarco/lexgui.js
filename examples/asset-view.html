<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>LexGUI AssetView Demo</title>
    <link rel="stylesheet" href="../build/lexgui.css">
    <link rel="icon" href="../images/favicon.png">
    <script type="importmap">
        {
          "imports": {
            "lexgui": "../build/lexgui.module.js",
            "lexgui/extensions/": "../build/extensions/"
          }
        }
    </script>
</head>

<body></body>
<script type="module">

    import { LX } from 'lexgui';
    import { CodeEditor } from 'lexgui/extensions/CodeEditor.js';
    import { AssetView } from 'lexgui/extensions/AssetView.js';

    // Init library and get main area
    let area = await LX.init();

    // Split main area
    var [topArea, bottomArea] = area.split({ type: 'vertical', sizes: ["60vh", "40vh"] });
    bottomArea.setLimitBox(0, 450);

    // Add canvas to topArea
    var canvas = document.createElement('canvas');
    canvas.id = "mycanvas";
    canvas.width = topArea.root.clientWidth;
    canvas.height = topArea.root.clientHeight;
    canvas.style.width = "100%";
    canvas.style.height = "100%";
    topArea.attach(canvas);

    // Add on resize event to control canvas size
    topArea.onresize = function (bounding) {
        canvas.width = bounding.width;
        canvas.height = bounding.height;
    };

    let assetView = new AssetView({
        // useNativeTitle: true,
        // skipBrowser: true,
        // skipPreview: true,
        // rootPath: "../",
        // onlyFolders: false,
        allowedTypes: {
            "Mesh": { color: "rose-800" },
            "Script": { color: "orange-500" },
            "Clip": { color: "fuchsia-600" },
            "SIGML": { color: "emerald-300" },
        },
        itemContextMenuOptions: [
            { name: "Like", callback: ( item ) => { console.log(item) } }
        ]
    });
    bottomArea.attach(assetView);

    window.av = assetView;

    let assetData = [
        {
            id: "dog.png",
            type: "image",
            src: "https://pngfre.com/wp-content/uploads/1653714420512-1-904x1024.png"
        },
        {
            id: "greenland_grid_velo.bmp",
            type: "image",
            src: "https://people.math.sc.edu/Burkardt/data/bmp/greenland_grid_velo.bmp"
        },
        {
            id: "Fox Monochrome.avif",
            type: "image",
            src: "https://raw.githubusercontent.com/link-u/avif-sample-images/refs/heads/master/fox.profile0.10bpc.yuv420.monochrome.avif"
        },
        {
            id: "Avatar",
            type: "Avatar",
            metadata: {
                preview: "https://models.readyplayer.me/66e30a18eca8fb70dcadde68.png?background=68,68,245",
                volume: 0.5,
            }
        },
        {
            id: "video-test",
            type: "video",
            src: "https://catsl.eelvex.net/static/vid/teacher-video-Î¨.mp4",
            metadata: {
                preview: "https://godotengine.org/assets/press/logo_vertical_color_dark.png",
                volume: 0.5,
            }
        },
        {
            id: "nyan-pyportal.gif",
            type: "image",
            src: "../data/nyan-pyportal.gif"
        },
        {
            id: "sigml_test.sigml",
            type: "sigml",
            src: "../data/sigml_test.sigml",
            metadata: {
                lastModified: 1740588312813
            }
        },
        {
            id: "json_sample.json",
            type: "JSON",
            src: "../data/json_sample.json",
            metadata: {
                lastModified: 1740581312813
            }
        },
        {
            id: "godot",
            type: "folder",
            children: [
                {
                    id: "color.png",
                    type: "image",
                    src: "https://godotengine.org/assets/press/icon_color.png"
                },
                {
                    id: "monochrome_light.png",
                    type: "image",
                    src: "https://godotengine.org/assets/press/icon_monochrome_light.png"
                },
                {
                    id: "example.png",
                    type: "image",
                    src: "../data/godot_pixelart.png"
                },
                {
                    id: "vertical_color.png",
                    type: "image",
                    src: "https://godotengine.org/assets/press/logo_vertical_color_dark.png"
                },
                {
                    id: "doggies",
                    type: "folder",
                    children: [
                        {
                            id: "pepe.png",
                            type: "image",
                            src: "https://pngfre.com/wp-content/uploads/1653714420512-1-904x1024.png"
                        }
                    ]
                }
            ]
        },
        {
            id: "blacky.png",
            type: "image",
            src: "https://www.pngall.com/wp-content/uploads/5/Black-Dog-PNG.png"
        },
        {
            id: "german.png",
            type: "image",
            path: "https://static.vecteezy.com/system/resources/previews/017/420/504/original/portrait-of-a-dog-png.png"
        },
        {
            id: "unreal",
            type: "folder",
            children: [
                {
                    id: "color.png",
                    type: "image",
                    src: "https://cdn2.unrealengine.com/ue-logotype-2023-vertical-white-1686x2048-bbfded26daa7.png"
                },
                {
                    id: "demo.js",
                    type: "script",
                    src: "../data/script.js"
                },
                {
                    id: "empty_folder",
                    type: "folder",
                    children: [{
                        id: "another_empty_folder",
                        type: "folder",
                        children: []
                    }]
                }
            ]
        },
        {
            id: "brow_lowerer.png",
            type: "clip",
            src: "../data/brow_lowerer.png",
            metadata: {
                lastModified: 1740181312813
            }
        }
    ];

    const fakeServerRequest = function( payload, delay = 800 ) {
        return new Promise(resolve => {
            setTimeout(() => {
                // 70% chance to allow the action
                const ok = Math.random() > 0.3;
                resolve({
                    ok,
                    reason: ok ? undefined : "Server rejected the operation"
                });
            }, delay);
        });
    }

    // Click events
    {
        assetView.on( "select", ( event, resolve ) => {
            console.log(`${ event.items[ 0 ].id } selected` );
        } );

        assetView.on( "dblClick", ( event ) => {
            console.log(`${ event.items[ 0 ].id } dbl clicked` );
        } );
    }

    // Folder events
    {
        assetView.on( "enterFolder", async ( event ) => {
            console.log(`Entered ${ event.to.id } folder` );

            // const r = await (() => { return new Promise(resolve => {
            //     setTimeout(() => {
            //         resolve({
            //             ok: true
            //         });
            //     }, 2000);
            // }) })();

            // if( r?.ok )
            // {
            //     event.to.children = [
            //         {
            //             id: "brow_lowerer.png",
            //             type: "clip",
            //             src: "../data/brow_lowerer.png",
            //             metadata: {
            //                 lastModified: 1740181312813
            //             }
            //         },
            //         {
            //             id: "brow_lowerer.png",
            //             type: "clip",
            //             src: "../data/brow_lowerer.png",
            //             metadata: {
            //                 lastModified: 1740181312813
            //             }
            //         }
            //     ]
            // }

            // return true;

        });

        assetView.on( "beforeCreateFolder", ( event, resolve ) => {
            LX.prompt("Perform CreateFolder Action?", "Server Message", () => {
                resolve();
            })
        } );

        assetView.on( "createFolder", ( event ) => {
            console.log(`${ event.result[ 0 ].id } folder created`);
        } );
    }

    // Rename events
    {
        assetView.on( "beforeRename", ( event, resolve ) => {
            LX.prompt("Perform Rename Action?", "Server Message", () => {
                resolve();
            })
        } );

        assetView.on( "rename", ( event ) => {
            console.log(`${ event.oldName } renamed to ${ event.newName }`);
        } );
    }

    // Delete events
    {
        assetView.on( "beforeDelete", ( event, resolve ) => {
            LX.prompt("Perform Delete Action?", "Server Message", () => {
                resolve();
            })
        } );

        assetView.on( "delete", ( event ) => {
            console.log(event.items[ 0 ].id + " deleted");
        } );
    }

    // Clone events
    {
        assetView.on( "beforeClone", ( event, resolve ) => {
            LX.prompt("Perform Clone Action?", "Server Message", (value) => {
                resolve( value );
            })
        } );

        assetView.on( "clone", ( event, arg1, arg2 ) => {
            console.log(event.items[ 0 ].id + " cloned",  arg1, arg2);
        } );
    }

    // Move events
    {
        assetView.on( "beforeMove", ( event, resolve ) => {
            LX.prompt("Perform Move Action?", "Server Message", () => {
                resolve();
            })
        } );

        assetView.on( "move", ( event ) => {
            console.log(`${ event.items[ 0 ].id } moved to ${ event.to.id }` );
        } );
    }

    // Content events
    {
        assetView.on( "beforeRefreshContent", ( event, resolve ) => {
            resolve();
        } );

        assetView.on( "refreshContent", ( event ) => {
            console.log(`Content updated (${ event.items.length } items) [${ event.search.join( "," ) }]` );
        } );
    }

    assetView.load( assetData );

    function loop( dt )
    {
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "#b7a9b1";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.font = "48px Monospace";
        ctx.fillStyle = "#ff1999";

        const text = "Lexgui.js @jxarco";
        ctx.fillText(text, 300, 300);

        requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);

</script>

</html>