<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>LexGUI Code Editor Demo</title>
    <link rel="stylesheet" href="../build/lexgui.css">
    <link rel="icon" href="../images/favicon.png">
    <script type="importmap">
        {
          "imports": {
            "lexgui": "../build/lexgui.module.js",
            "lexgui/extensions/": "../build/extensions/"
          }
        }
    </script>
</head>

<body></body>
<script type="module">

    import { LX } from 'lexgui';
    import { CodeEditor } from 'lexgui/extensions/CodeEditor.js';

    CodeEditor.debugScopes = false;
    CodeEditor.debugSymbols = false;
    CodeEditor.debugProcessedLines = false;

    // init library and get main area
    let area = await LX.init();

    const starterTheme = LX.getMode();
    const menubar = area.addMenubar( [], { sticky: false } );
    menubar.addButtons([
        {
            title: "Change Theme",
            icon: starterTheme == "dark" ? "Moon" : "Sun",
            swap: starterTheme == "dark" ? "Sun" : "Moon",
            callback: () => LX.switchMode()
        }
    ]);

    const fileExplorer = true;

    if( !fileExplorer )
    {
        var [ leftArea, rightArea ] = area.split({ sizes: ["55%", "45%"] });

        var canvas = document.createElement('canvas');
        canvas.id = "mycanvas";
        canvas.width = leftArea.root.clientWidth;
        canvas.height = leftArea.root.clientHeight;
        canvas.style.width = "100%";
        canvas.style.height = "100%";
        leftArea.attach(canvas);

        leftArea.onresize = function (bounding) {
            canvas.width = bounding.width;
            canvas.height = bounding.height;
        };

        area = rightArea;
    }

    let editor = new CodeEditor(area, {
        // allowAddScripts: false,
        // autocomplete: false,
        // disableEdition: true,
        // skipInfo: true,
        fileExplorer: fileExplorer,
        explorerName: "EXPLORER",
        highlight: 'TypeScript',
        // statusShowFontSizeZoom: false,
        // skipTabs: true,
        xonCreateFile: ( instance ) => {
            return { name: "new_shader.wgsl", language: "WGSL" }
        },
        onCtrlSpace: () => console.log("Ctrl + Space pressed"),
        onRun: () => console.log("Script running"),
        onSave: () => console.log("Script saved"),
        onContextMenu: ( editor, content, event ) => {
            if( !content ) return;
            return [
                { path: "Custom Action", callback: () => console.log( content ) }
            ];
        },
    });

        await editor.init();

        editor.loadFiles( [
            "../data/js_sample.js",
            "../data/ts_sample.ts",
            "../data/json_sample.json",
            "../data/css_sample.css",
            "../data/cpp_sample.cpp",
            "../data/cpp_header_sample.hpp",
            "../data/c_sample.c",
            "../data/xml_sample.xml",
            "../data/python_sample.py",
            "../data/rust_sample.rs",
            "../data/php_sample.php",
            "../data/localhost.bat",
            "../data/frag.wgsl",
            "../changelog.md",
            "../index.html",
        ], ( instance, results, numFilesLoaded ) => {
            console.log( `CodeEditor: ${ numFilesLoaded } files loaded!` );
            instance.loadTab("js_sample.js");
        } );

        editor.setText(`// Example TypeScript file for syntax highlighting

// Type alias and interface
type ID = number | string;

interface Person {
    id: ID;
    name: string;
    age?: number;
}

// Enum
enum Role {
    Admin,
    User,
    Guest
}

// Class with generics and inheritance
class User<T extends Person> {
    private role: Role;

    constructor(public data: T, role: Role = Role.User) {
        this.role = role;
    }

    get id(): ID {
        return this.data.id;
    }

    printInfo(): void {
        console.log(\`\${this.data.name} (\${Role[this.role]})\`);
    }
}

// Generic function
function identity<T>(value: T): T {
    return value;
}

// Arrow function and async/await
const fetchUser = async (id: ID): Promise<Person> => {
    return { id, name: "Alice", age: 25 };
};

// Union, intersection, type assertions
let input: string | number = "42";
let result = (input as string).toUpperCase();

// Arrays, tuples
let nums: number[] = [1, 2, 3];
let pair: [string, number] = ["age", 30];

// Map, Set (built-ins)
const map = new Map<string, number>();
map.set("one", 1);

const set = new Set<ID>([1, "two"]);

// Usage
(async () => {
    const person = await fetchUser(1);
    const user = new User(person, Role.Admin);
    user.printInfo();
    console.log(identity(nums));
})();`);

    editor.loadFile("../data/js_sample.js");
    editor.loadFile("../data/json_sample.json");
    editor.loadFile("../data/frag.wgsl");
    editor.loadFile("../data/python_sample.py");
    editor.loadFile("../data/php_sample.php");
    editor.loadFile("../data/c_sample.c");
    editor.loadFile("../data/rust_sample.rs");
    editor.loadFile("../data/cpp_sample.cpp");
    editor.loadFile("../data/cpp_header_sample.hpp");
    editor.loadFile("../data/css_sample.css");
    editor.loadFile("../data/xml_sample.xml");
    editor.loadFile("../data/localhost.bat");
    editor.loadFile("../data/animation.bml", { language: "JSON" });
    editor.loadFile("../data/CMakeLists.txt", { language: "CMake" });
    editor.loadFile("../icons/index.html");
    editor.loadFile("../README.md");

    if( !fileExplorer )
    {
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "#b7a9b1";
        ctx.font = "48px Monospace";
        ctx.strokeStyle = "#ff1999";

        function loop(dt) {

            var ctx = canvas.getContext("2d");

            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeText("Lexgui.js @jxarco", 200, 300);

            requestAnimationFrame(loop);
        }

        requestAnimationFrame(loop);
    }

</script>

</html>